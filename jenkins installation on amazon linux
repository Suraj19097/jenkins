#!/bin/bash
# Script to install Jenkins on Amazon Linux 2023
# Author: Suraj Patil

set -e

echo "🔹 Updating system packages..."
sudo dnf update -y

echo "🔹 Installing Java 17 (Amazon Corretto)..."
sudo dnf install java-17-amazon-corretto -y

echo "✅ Java version installed:"
java -version

echo "🔹 Adding Jenkins repository..."
sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key

echo "🔹 Installing Jenkins..."
sudo dnf install jenkins -y

echo "🔹 Enabling and starting Jenkins service..."
sudo systemctl enable jenkins
sudo systemctl start jenkins

echo "✅ Jenkins service status:"
sudo systemctl status jenkins --no-pager

echo "🔹 Fetching initial admin password..."
sudo cat /var/lib/jenkins/secrets/initialAdminPassword

echo "🎉 Jenkins installation completed successfully!"
echo "👉 Access Jenkins at: http://<your-ec2-public-ip>:8080"
